-- Create the database if it doesn't exist
CREATE DATABASE IF NOT EXISTS LeagueStats;
USE LeagueStats;

-- Create the ChampionTbl table
CREATE TABLE IF NOT EXISTS ChampionTbl (
  ChampionId INT AUTO_INCREMENT PRIMARY KEY,
  ChampionName VARCHAR(100) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci;

-- Create the ItemTbl table
CREATE TABLE IF NOT EXISTS ItemTbl (
  ItemID INT AUTO_INCREMENT PRIMARY KEY,
  ItemLink MEDIUMTEXT NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci;

-- Create the MatchStatsTbl table
CREATE TABLE IF NOT EXISTS MatchStatsTbl (
  MatchStatsId INT AUTO_INCREMENT PRIMARY KEY,
  SummonerMatchFk INT NOT NULL,
  MinionsKilled INT NOT NULL,
  DmgDealt INT NOT NULL,
  DmgTaken INT NOT NULL,
  TurretDmgDealt INT NOT NULL,
  TotalGold INT NOT NULL,
  Lane VARCHAR(55) NOT NULL,
  Win TINYINT(1) NOT NULL,
  item1 INT NOT NULL,
  item2 INT NOT NULL,
  item3 INT NOT NULL,
  item4 INT NOT NULL,
  item5 INT NOT NULL,
  item6 INT NOT NULL,
  kills INT NOT NULL,
  deaths INT NOT NULL,
  assists INT NOT NULL,
  PrimaryKeyStone INT NOT NULL,
  PrimarySlot1 INT NOT NULL,
  PrimarySlot2 INT NOT NULL,
  PrimarySlot3 INT NOT NULL,
  SecondarySlot1 INT NOT NULL,
  SecondarySlot2 INT NOT NULL,
  SummonerSpell1 INT NOT NULL,
  SummonerSpell2 INT NOT NULL,
  CurrentMasteryPoints INT NOT NULL,
  EnemyChampionFk INT NOT NULL,
  DragonKills INT NOT NULL,
  BaronKills INT NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci;

-- Create the MatchTbl table
CREATE TABLE IF NOT EXISTS MatchTbl (
  MatchId INT AUTO_INCREMENT PRIMARY KEY,
  Patch VARCHAR(55) NOT NULL DEFAULT '13.4',
  QueueType VARCHAR(100) NOT NULL,
  RankFk INT NOT NULL,
  GameDuration INT NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci;

-- Create the RankTbl table
CREATE TABLE IF NOT EXISTS RankTbl (
  RankId INT PRIMARY KEY,
  Rank VARCHAR(55) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci;

-- Insert data into RankTbl
INSERT INTO RankTbl (RankId, Rank) VALUES
(1, 'Unranked'),
(2, 'Iron'),
(3, 'Bronze'),
(4, 'Silver'),
(5, 'Gold'),
(6, 'Platinum'),
(7, 'Diamond'),
(8, 'Master'),
(9, 'Grandmaster'),
(10, 'Challenger');

-- Create the SummonerMatchTbl table
CREATE TABLE IF NOT EXISTS SummonerMatchTbl (
  SummonerMatchId INT AUTO_INCREMENT PRIMARY KEY,
  SummonerFk INT NOT NULL,
  MatchFk INT NOT NULL,
  ChampionFk INT NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci;

-- Create the SummonerUserTbl table
CREATE TABLE IF NOT EXISTS SummonerUserTbl (
  SummonerID INT AUTO_INCREMENT PRIMARY KEY,
  SummonerName VARCHAR(155) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci;

-- Create the TeamMatchTbl table
CREATE TABLE IF NOT EXISTS TeamMatchTbl (
  TeamID INT AUTO_INCREMENT PRIMARY KEY,
  MatchFk INT NOT NULL,
  B1Champ INT NOT NULL,
  B2Champ INT NOT NULL,
  B3Champ INT NOT NULL,
  B4Champ INT NOT NULL,
  B5Champ INT NOT NULL,
  R1Champ INT NOT NULL,
  R2Champ INT NOT NULL,
  R3Champ INT NOT NULL,
  R4Champ INT NOT NULL,
  R5Champ INT NOT NULL,
  BlueBaronKills INT NOT NULL,
  BlueRiftHeraldKills INT NOT NULL,
  BlueDragonKills INT NOT NULL,
  BlueTowerKills INT NOT NULL,
  BlueKills INT NOT NULL,
  RedBaronKills INT NOT NULL,
  RedRiftHeraldKills INT NOT NULL,
  RedDragonKills INT NOT NULL,
  RedTowerKills INT NOT NULL,
  RedKills INT NOT NULL,
  RedWin INT NOT NULL,
  BlueWin INT NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci;

-- Add foreign key constraints
ALTER TABLE MatchStatsTbl
  ADD CONSTRAINT FK_MatchStats_SummonerMatch FOREIGN KEY (SummonerMatchFk) REFERENCES SummonerMatchTbl (SummonerMatchId),
  ADD CONSTRAINT FK_MatchStats_Item1 FOREIGN KEY (item1) REFERENCES ItemTbl (ItemID),
  ADD CONSTRAINT FK_MatchStats_Item2 FOREIGN KEY (item2) REFERENCES ItemTbl (ItemID),
  ADD CONSTRAINT FK_MatchStats_Item3 FOREIGN KEY (item3) REFERENCES ItemTbl (ItemID),
  ADD CONSTRAINT FK_MatchStats_Item4 FOREIGN KEY (item4) REFERENCES ItemTbl (ItemID),
  ADD CONSTRAINT FK_MatchStats_Item5 FOREIGN KEY (item5) REFERENCES ItemTbl (ItemID),
  ADD CONSTRAINT FK_MatchStats_Item6 FOREIGN KEY (item6) REFERENCES ItemTbl (ItemID),
  ADD CONSTRAINT FK_MatchStats_EnemyChampion FOREIGN KEY (EnemyChampionFk) REFERENCES ChampionTbl (ChampionId);

ALTER TABLE MatchTbl
  ADD CONSTRAINT FK_Match_Rank FOREIGN KEY (RankFk) REFERENCES RankTbl (RankId);

ALTER TABLE SummonerMatchTbl
  ADD CONSTRAINT FK_SummonerMatch_Summoner FOREIGN KEY (SummonerFk) REFERENCES SummonerUserTbl (SummonerID),
  ADD CONSTRAINT FK_SummonerMatch_Match FOREIGN KEY (MatchFk) REFERENCES MatchTbl (MatchId),
  ADD CONSTRAINT FK_SummonerMatch_Champion FOREIGN KEY (ChampionFk) REFERENCES ChampionTbl (ChampionId);

ALTER TABLE TeamMatchTbl
  ADD CONSTRAINT FK_TeamMatch_Match FOREIGN KEY (MatchFk) REFERENCES MatchTbl (MatchId);
